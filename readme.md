# 土特产 (Local Specialties)
这是一个 Minecraft mod, 主要修改了原版的种植体系, 
目的是使作物对生物群系有很强的依赖性

## 基本设定

下列特性前的复选框表示了开发进度, 打钩的是已开发完成的, 否则是待实现的.

### 作物属性

计划影响的作物只有属于 `net.minecraft.block.CropsBlock` 的实例.

原版作物: 小麦, 胡萝卜, 土豆(马铃薯), 甜菜根

- [x] 禁止骨粉催熟作物的设定, 对作物使用骨粉可以增加作物下方土壤的肥力.

#### 生长速度

生长速度受环境因素影响, 当条件适宜时生长加快, 不适宜时会减慢甚至停止生长.

随机刻时, 植物的 age 属性有概率增加 0, 1, 或 2. 以原版的最大生长期望和标准差为默认值, 根据环境浮动.

#### 枯萎概率

当环境过于恶劣时, 作物将有几率枯死, 枯死概率随不适宜程度增加

当随机刻时, 植物有概率枯萎, 变成枯死的灌木. 枯萎概率与环境有关, 当环境适宜时枯萎概率为0.

#### 结实率
生物群系适宜时, 作物将有更高的结实率; 反过来甚至可以不结实.

结实率为浮点数, 默认为 1.0, 根据环境变量上下浮动. 结实率的整数部分会直接对战利品数量造成影响, 小数部分则按概率增加战利品.

例如, 2.3 的结实率会使 小麦 有 70% 的概率产生 2 个小麦, 30% 的概率产生 3 个小麦; 而 0.8 的结实率则会使其以 20% 概率不产生小麦, 80% 的概率产生一个小麦. 它们的种子掉落数量也受到同样的影响.

#### 虫害

实现方式尚不明晰.

### 环境因素

#### 土壤肥力
为原版的耕地增加了 fertility 方块属性, 范围为 0-7. 作物生长有机会消耗肥力. 作物生长速度和结实率受土壤肥力影响.

**土壤肥力并不是越高越好**, 过高或过低的土壤肥力会使作物枯死.

- 肥力过高会使植物根部失水致死
- 肥力过低会使植物营养不良



主要特性:

- [x] 用锄头右键单击耕地, 可以为耕地 "松土": 对于单击耕地 3x3 范围内的耕地, 如果单击的耕地的肥力 > 周围耕地的肥力 + 1, 则周围符合上述条件的耕地的肥力 + 1, 单击的耕地肥力 - 1

- [x] 当耕地变为 "土壤" 方块时 (比如被踩、失水), 会根据土壤肥力变化为对应的 "土壤" 方块:

| 土壤肥力 | 对应方块 |
| -------- | -------- |
| 7        |          |
| 6        | 灰化土   |
| 5        |          |
| 4        | 泥土方块 |
| 3        |          |
| 2        | 砂土方块 |
| 1        |          |
| 0        | 砂砾     |

- [x] 对不同的方块使用锄头可以得到不同肥力的耕地

| 土壤肥力 | 原方块 |
| -------- | ------ |
| 7 |        |
| 6 | 灰化土 |
| 5 | 草径 |
| 4 | 草方块、泥土方块 |
| 3 | |
| 2 | 砂土方块|
| 1 | |
| 0 | |

- [ ] 不同肥力的耕地在材质上有些许不同
- [x] 使用骨粉可以为耕地增加肥力
- [x] 作物有概率在作物发生随机刻时消耗土壤肥力
- [x] 特殊作物在随机刻时会增加土壤肥力 (甜菜根)
- [ ] 作物在枯萎时有概率增加土壤肥力

#### 土壤湿度

与原版设定不同, 耕地的稳态湿度和周围 9x9x2 方块 (所在平面内和向上一格的平面) 内的水源方块数量有关. 

土壤湿度不可过高也不可过低:

- 过高土壤湿度会导致土壤含氧量降低, 植物根部细胞有窒息的风险
- 过低土壤湿度会使植物蒸腾作用不足, 植物有干死的风险

主要特性:

- [x] 耕地随机刻时:
  - 如果土壤湿度如果小于稳态湿度, 则土壤湿度会变为稳态湿度; 
  - 如果土壤湿度大于稳态湿度, 则土壤湿度 -1; 
  - 如果土壤湿度为0, 且范围内没有水方块, 则耕地会根据其肥力状态变为相应的方块
  - 如果耕地淋雨, 则统计的水源方块数+10

| 稳态土壤湿度 | 水源方块数 |
| ------------ | ---------- |
| 0            | 0          |
| 1            | 1-3        |
| 2            | 4-6        |
| 3            | 7-9        |
| 4            | 10-12      |
| 5            | 13-15      |
| 6            | 16-18      |
| 7            | 19 及以上  |

- [x] 作物有概率在作物发生随机刻时消耗土壤湿度

#### 环境温度

游戏中, 环境温度由以下因素决定:

- [ ] 生物群系温度
- [ ] 天气
- [ ] 生物群系湿度 (影响天气、季节和昼夜对温度的改变)
- [ ] 季节
- [ ] 天空光照

#### 环境湿度

- [ ] 生物群系湿度
- [ ] 季节
- [ ] 天气

#### 光照

现实中人造光的实际功率是远远低于太阳光的, 亮度差不多只是人的错觉. 因此, 天空光照替代了方块光源决定作物的生长:

- 不足的天空光照将使作物生长速度降低
- 方块光源也可以保障作物生长, 只是速度稍慢
- 过多的天空光照也可能导致作物枯萎 (有色玻璃安排一下)

#### 生物群系

实际中植物的生长速度、枯萎概率、结实率往往和当地积温有关. 然而, 游戏中使作物记录积温是繁琐且性能不友好的, 而实际中积温只与当地的气候条件有关, 因此生物群系将通过生物群系积温影响植物的生长过程. 

积温会在游戏启动时进行计算, 游戏内不会变化

影响积温的因素:

- 生物群系本底温度
- 生物群系本底湿度
- 季节温度
- 季节湿度

#### 季节

- [ ] 与 Serene Season 的联动

#### 空气流动性

保持原版设定

### 墒情查看器

- [ ] 用于查看耕地状态
- [ ] 一手墒情查看器, 一手作物种子, 可以看到哪块耕地更适合该作物
  - [ ] 最适合画绿叉
  - [ ] 一般的画黄叉
  - [ ] 最差的画红叉
